!function(e){function t(e){e.find(".fs-option.hl").removeClass("hl"),e.find(".fs-search input").focus(),window.fSelect.idx=-1}function s(e){var t=e.find(".fs-options"),i=e.find(".fs-option.hl"),s=i.offset().top+t.scrollTop(),l=s+i.outerHeight(),a=t.offset().top+t.scrollTop(),n=a+t.outerHeight();if(l>n){o=t.scrollTop()+l-n;t.scrollTop(o)}else if(s<a){var o=t.scrollTop()-a-s;t.scrollTop(o)}}function l(e){window.fSelect.active_el=e,window.fSelect.active_id=e.data("id"),window.fSelect.initial_values=e.find("select").val(),e.find(".fs-dropdown").removeClass("hidden"),e.find("button").attr("aria-expanded","true"),e.addClass("fs-open"),t(e)}function a(t){if(void 0===t&&null!=window.fSelect.active_el&&(t=window.fSelect.active_el),void 0!==t){var i=window.fSelect.initial_values,s=t.find("select").val();JSON.stringify(i)!=JSON.stringify(s)&&e(document).trigger("fs:closed",t)}e(".fs-wrap").removeClass("fs-open"),e(".fs-dropdown").addClass("hidden"),e('.facetwp-type-fselect .fs-label-wrap[aria-expanded="true"]').attr("aria-expanded","false"),window.fSelect.active_el=null,window.fSelect.active_id=null,window.fSelect.last_choice=null}e.fn.fSelect=function(t){function i(t,i){this.$select=e(t),this.settings=i,this.create()}if("string"==typeof t)s=t;else var s=e.extend({placeholder:"Select some options",numDisplayed:3,overflowText:"{n} selected",searchText:"Search",showSearch:!0,optionFormatter:!1},t);return i.prototype={create:function(){this.settings.multiple=this.$select.is("[multiple]");var e=this.settings.multiple?" multiple":"";this.$select.wrap('<div class="fs-wrap'+e+'" />');var t=this.$select.parents(".widget").first().find(".form-control-label").text(),i=this.$select.parents(".widget").first().find(".form-control-label").attr("id");this.$select.before('<button id="button-'+i+'" type="button" class="fs-label-wrap border-0 p-0 text-left w-100" aria-haspopup="true" aria-expanded="false"><span class="sr-only">'+t+'</span><div class="fs-label">'+this.settings.placeholder+"</div></button>"),this.$select.before('<div class="fs-dropdown hidden"><ul class="fs-options list-unstyled" role="group" aria-labelledby="button-'+i+'"></ul></div>'),this.$select.addClass("hidden"),this.$wrap=this.$select.closest(".fs-wrap"),this.$wrap.data("id",window.fSelect.num_items),window.fSelect.num_items++,this.reload()},reload:function(){if(this.settings.showSearch){var e='<div class="fs-search"><input type="search" aria-label="'+this.settings.searchText+'" placeholder="'+this.settings.searchText+'"/></div>';this.$wrap.find(".fs-dropdown").prepend(e)}this.idx=0,this.optgroup=0,this.selected=[].concat(this.$select.val());var t=this.buildOptions(this.$select);this.$wrap.find(".fs-options").html(t),this.reloadDropdownLabel()},destroy:function(){this.$wrap.find(".fs-label-wrap").remove(),this.$wrap.find(".fs-dropdown").remove(),this.$select.unwrap().removeClass("hidden")},buildOptions:function(t){var i=this,s="";return t.children().each(function(t,l){var a=e(l);if("optgroup"==a.prop("nodeName").toLowerCase())s+='<div class="fs-optgroup-label" data-group="'+i.optgroup+'">'+a.prop("label")+"</div>",s+=i.buildOptions(a),i.optgroup++;else{var n=a.prop("value");if(0<i.idx||""!=n||!i.settings.multiple){var o=a.is(":disabled")?" disabled":"",d=-1<e.inArray(n,i.selected)?" selected":"",r=-1<e.inArray(n,i.selected)?"true":"false",f='<li class="fs-option'+d+o+(" g"+i.optgroup)+'" data-value="'+n+'" data-index="'+i.idx+'"><span class="fs-checkbox" aria-hidden="true"><i aria-hidden="true"></i></span><span class="fs-option-label" role="checkbox" aria-checked="'+r+'" tabindex="0">'+a.html()+"</span></li>";"function"==typeof i.settings.optionFormatter&&(f=i.settings.optionFormatter(f)),s+=f,i.idx++}}}),s},reloadDropdownLabel:function(){var t=this.settings,i=[];this.$wrap.find(".fs-option.selected").each(function(t,s){i.push(e(s).find(".fs-option-label").text()),e(s).find(".fs-option-label").attr("aria-checked","true")}),i=i.length<1?t.placeholder:i.length>t.numDisplayed?t.overflowText.replace("{n}",i.length):i.join(", "),this.$wrap.find(".fs-label").html(i),this.$wrap.toggleClass("fs-default",i===t.placeholder),this.$select.change()}},this.each(function(){var t=e(this).data("fSelect");t||(t=new i(this,s),e(this).data("fSelect",t)),"string"==typeof s&&t[s]()})},window.fSelect={num_items:0,active_id:null,active_el:null,last_choice:null,idx:-1},e(document).on("click",".fs-option:not(.hidden, .disabled)",function(t){var s=e(this).closest(".fs-wrap"),l=!1;if(s.hasClass("multiple")){f=[];if(t.shiftKey&&null!=window.fSelect.last_choice){var n=parseInt(e(this).attr("data-index")),o=!e(this).hasClass("selected"),d=Math.min(window.fSelect.last_choice,n),r=Math.max(window.fSelect.last_choice,n);for(i=d;i<=r;i++)s.find(".fs-option[data-index="+i+"]").not(".hidden, .disabled").each(function(){e(this).toggleClass("selected",o),e(this).find(".fs-option-label").attr("aria-checked",o)})}else window.fSelect.last_choice=parseInt(e(this).attr("data-index")),e(this).toggleClass("selected"),e(this).find(".fs-option-label").attr("aria-checked",!e(this).find(".fs-option-label").attr("aria-checked"));s.find(".fs-option.selected").each(function(t,i){f.push(e(i).attr("data-value"))})}else{var f=e(this).attr("data-value");s.find(".fs-option").removeClass("selected"),e(this).addClass("selected"),l=!0}s.find("select").val(f),s.find("select").fSelect("reloadDropdownLabel"),e(document).trigger("fs:changed",s),l&&a(s)}),e(document).on("keyup",".fs-search input",function(i){if(40!=i.which){var s=e(this).closest(".fs-wrap"),l=/[|\\{}()[\]^$+*?.]/g,a=e(this).val().replace(l,"\\$&");s.find(".fs-option, .fs-optgroup-label").removeClass("hidden"),""!=a&&(s.find(".fs-option").each(function(){var t=new RegExp(a,"gi");null===e(this).find(".fs-option-label").text().match(t)&&e(this).addClass("hidden")}),s.find(".fs-optgroup-label").each(function(){var t=e(this).attr("data-group");e(this).closest(".fs-options").find(".fs-option.g"+t+":not(.hidden)").length<1&&e(this).addClass("hidden")})),t(s)}else e(this).blur()}),e(document).on("click",function(t){var i=e(t.target),s=i.closest(".fs-wrap");0<s.length?(s.data("id")!==window.fSelect.active_id&&a(),(i.hasClass("fs-label-wrap")||i.hasClass("fs-label"))&&(s.find(".fs-dropdown").hasClass("hidden")?l(s):a(s))):a()}),e(document).on("keydown",function(t){var i=window.fSelect.active_el,l=e(t.target);if(l.hasClass("fs-wrap")){if(32==t.which)return void l.find(".fs-label").trigger("click")}else if(0<l.closest(".fs-search").length){if(32==t.which)return}else if(null===i)return;if(38==t.which){t.preventDefault(),i.find(".fs-option.hl").removeClass("hl");var n=(o=i.find(".fs-option[data-index="+window.fSelect.idx+"]")).prevAll(".fs-option:not(.hidden, .disabled)");n.length>0?(window.fSelect.idx=parseInt(n.attr("data-index")),i.find(".fs-option[data-index="+window.fSelect.idx+"]").addClass("hl"),s(i)):(window.fSelect.idx=-1,i.find(".fs-search input").focus())}else if(40==t.which){t.preventDefault();var o=i.find(".fs-option[data-index="+window.fSelect.idx+"]");if(o.length<1)d=i.find(".fs-option:not(.hidden, .disabled):first");else var d=o.nextAll(".fs-option:not(.hidden, .disabled)");d.length>0&&(window.fSelect.idx=parseInt(d.attr("data-index")),i.find(".fs-option.hl").removeClass("hl"),i.find(".fs-option[data-index="+window.fSelect.idx+"]").addClass("hl"),s(i))}else 32==t.which||13==t.which?(t.preventDefault(),i.find(".fs-option.hl").click()):27==t.which&&a(i)})}(jQuery);
